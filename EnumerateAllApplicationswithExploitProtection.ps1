#Requires -RunAsAdministrator

<#
.SYNOPSIS
    Enumerates all application executables that have custom Exploit Protection
    settings configured in the Windows Registry.
#>

# The registry path where process mitigation settings are stored.
$regPath = "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options"

Write-Host "Searching for applications with custom Exploit Protection settings..." -ForegroundColor Cyan
Write-Host ("-"*70)

try {
    # Get all application keys under the main path.
    $appKeys = Get-ChildItem -Path $regPath -ErrorAction Stop

    # Filter for keys that have a "MitigationOptions" value, which signifies a custom configuration.
    $appsWithMitigations = $appKeys | Where-Object {
        # The empty string for -Name checks for the (Default) property, but we check for MitigationOptions.
        Get-ItemProperty -Path $_.PSPath -Name "MitigationOptions" -ErrorAction SilentlyContinue
    } | Select-Object -ExpandProperty PSChildName | Sort-Object

    if ($appsWithMitigations) {
        Write-Host "Found $($appsWithMitigations.Count) application(s) with custom settings:" -ForegroundColor Green
        $appsWithMitigations | ForEach-Object {
            Write-Host " - $_"
        }
    }
    else {
        Write-Host "No applications found with custom Exploit Protection settings." -ForegroundColor Yellow
    }
}
catch {
    Write-Error "An error occurred while accessing the registry: $($_.Exception.Message)"
}